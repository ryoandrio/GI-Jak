<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
        <style>
            #map {
                bottom: 0;
                left: 0;
                position: absolute;
                right: 0;
                top: 0;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
        <script src="https://unpkg.com/georaster"></script>
        <script src="https://unpkg.com/chroma-js"></script>
        <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>

        <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

        <script>
            // initalize leaflet map
            var map = L.map("map").setView([-6.217821824221051, 106.8258108688532], 13);

            // add OpenStreetMap basemap
            L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png", {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
            }).addTo(map);

            /* GeoJSON */
            // var aoi = L.geoJson(null, {
            //     onEachFeature: function (feature, layer) {
            //         var popupContent = "<h4>AOI Jakarta</h4><hr>";
            //         layer.on({
            //             click: function (e) {
            //                 aoi.bindPopup(popupContent);
            //             },
            //             mouseover: function (e) {
            //                 aoi.bindTooltip(popupContent);
            //             },
            //         });
            //     },
            // });
            // $.getJSON("data/ar_kajian_gcs.geojson", function (data) {
            //     aoi.addData(data);
            //     // map.addLayer(aoi);
            // });

            // originally from https://globalwindatlas.info/downloads/gis-files
            var url_to_geotiff_file = "https://ryoandrio.github.io/images/UHI_JKT3.tif";

            // var clipArea = {
            //     type: "FeatureCollection",
            //     features: [
            //         {
            //             type: "Feature",
            //             properties: {},
            //             geometry: {
            //                 coordinates: [
            //                     [
            //                         [701738.905767768505029, 9314844.305263953283429],
            //                         [701756.257849514950067, 9314855.49737730063498],
            //                         [701772.124950483907014, 9314858.336163425818086],
            //                         [701783.443210041150451, 9314855.886188987642527],
            //                         [701868.517446732264943, 9314750.792023917660117],
            //                         [701941.371409187326208, 9314668.243269691243768],
            //                         [702023.907039343146607, 9314577.945712856948376],
            //                         [702086.442537211580202, 9314506.362607393413782],
            //                         [702118.04380423866678, 9314473.463184526190162],
            //                         [702147.72771239769645, 9314447.642836632207036],
            //                         [702183.8772263325518, 9314419.871344869956374],
            //                         [702229.74841343681328, 9314395.924047941341996],
            //                         [702294.417977565550245, 9314380.2702965028584],
            //                         [702277.253180943662301, 9314282.600766299292445],
            //                         [702273.188067458337173, 9314229.892787031829357],
            //                         [702271.569970764918253, 9314136.027615873143077],
            //                         [702254.365257930126972, 9314026.785574169829488],
            //                         [702261.774886506842449, 9313911.042365511879325],
            //                         [702260.692616850021295, 9313878.534773638471961],
            //                         [702275.801551126758568, 9313816.281179605051875],
            //                         [702308.244740449124947, 9313759.47075810469687],
            //                         [702337.873983653844334, 9313713.288910835981369],
            //                         [702390.143058059620671, 9313610.973581934347749],
            //                         [702424.279158912599087, 9313562.634878830984235],
            //                         [702445.934991588117555, 9313517.625954896211624],
            //                         [702472.257777541992255, 9313456.910851558670402],
            //                         [702498.663348096888512, 9313382.057126183062792],
            //                         [702508.792482276679948, 9313338.867507481947541],
            //                         [702523.719548526336439, 9313254.164349179714918],
            //                         [702532.010050305863842, 9313178.221726290881634],
            //                         [702528.737423432758078, 9313074.602639935910702],
            //                         [702529.797297094017267, 9313006.768926329910755],
            //                         [702527.447562743211165, 9312982.345395000651479],
            //                         [702527.616636137012392, 9312937.660621309652925],
            //                         [702527.548816368915141, 9312918.051258355379105],
            //                         [702532.122706800466403, 9312837.025365119799972],
            //                         [702534.236711624427699, 9312793.298375576734543],
            //                         [702540.079370570951141, 9312704.874500565230846],
            //                         [702547.020709103671834, 9312653.415684150531888],
            //                         [702552.043136860011145, 9312561.780175849795341],
            //                         [702552.933845784980804, 9312538.631482882425189],
            //                         [702556.895450176671147, 9312514.507770132273436],
            //                         [702560.676330816466361, 9312484.919761221855879],
            //                         [702563.513098668307066, 9312463.050225818529725],
            //                         [702567.647614334244281, 9312442.140604045242071],
            //                         [702572.091261057183146, 9312417.050858547911048],
            //                         [702582.299658114789054, 9312374.582002144306898],
            //                         [702587.706302723614499, 9312347.23868583701551],
            //                         [702593.116278051398695, 9312320.859765466302633],
            //                         [702609.415181504096836, 9312261.65367185883224],
            //                         [702625.432746176491491, 9312214.664270460605621],
            //                         [702640.487264477764256, 9312169.928484689444304],
            //                         [702656.214571778662503, 9312132.584078878164291],
            //                         [702676.451112173963338, 9312089.116234414279461],
            //                         [702692.500849768519402, 9312051.449274530634284],
            //                         [702702.106389713357203, 9312021.841269295662642],
            //                         [702712.99740623915568, 9311989.657105913385749],
            //                         [702729.233592836651951, 9311912.4494953379035],
            //                         [702750.630592465633526, 9311830.402122059836984],
            //                         [702757.314715050859377, 9311798.23262520506978],
            //                         [702768.506926099886186, 9311759.618248356506228],
            //                         [702775.833759134518914, 9311726.160702077671885],
            //                         [702785.708112724591047, 9311680.800220109522343],
            //                         [702791.382341027958319, 9311637.383113022893667],
            //                         [702792.262795285671018, 9311611.341620516031981],
            //                         [702796.914887461112812, 9311553.140861641615629],
            //                         [702800.648590599535964, 9311510.052036684006453],
            //                         [702804.674638117663562, 9311457.961309058591723],
            //                         [702808.425045471871272, 9311419.694407682865858],
            //                         [702810.872121687396429, 9311378.860366245731711],
            //                         [702816.867601977428421, 9311334.79942668415606],
            //                         [702821.775082015781663, 9311256.988957915455103],
            //                         [702826.588750294875354, 9311152.17629243992269],
            //                         [702832.132158113177866, 9311071.1492526140064],
            //                         [702829.409409263404086, 9311032.583610855042934],
            //                         [702823.441765274736099, 9310991.457595510408282],
            //                         [702805.097097315476276, 9310927.229589378461242],
            //                         [702792.028229408781044, 9310891.271650295704603],
            //                         [702766.582374555291608, 9310832.211753070354462],
            //                         [702733.356891441391781, 9310769.32144851796329],
            //                         [702704.106133606284857, 9310732.776895627379417],
            //                         [702676.129693933064118, 9310690.441711502149701],
            //                         [702639.771104635321535, 9310657.136446908116341],
            //                         [702606.652956399600953, 9310625.105767358094454],
            //                         [702577.44028055225499, 9310599.490665862336755],
            //                         [702526.854869331698865, 9310569.4493611715734],
            //                         [702474.33242321619764, 9310540.700587745755911],
            //                         [702414.706613488029689, 9310516.47681531496346],
            //                         [702350.523821466369554, 9310484.553882615640759],
            //                         [702331.063698558136821, 9310471.763156443834305],
            //                         [702304.4533519980032, 9310449.996479826048017],
            //                         [702265.479672291898169, 9310408.985379472374916],
            //                         [702246.611062708077952, 9310380.119874374940991],
            //                         [702225.796464122831821, 9310349.975311113521457],
            //                         [702166.893433751072735, 9310268.430718302726746],
            //                         [702120.409344956162386, 9310193.47110403329134],
            //                         [702077.419210098101757, 9310113.899713894352317],
            //                         [702051.340462995693088, 9310058.700221095234156],
            //                         [702027.395710411365144, 9310012.333323573693633],
            //                         [702002.153642938821577, 9309905.051883803680539],
            //                         [701909.776288469322026, 9309906.446803711354733],
            //                         [701809.98759495629929, 9309905.465119367465377],
            //                         [701714.405353233916685, 9309893.359985364601016],
            //                         [701645.974334024824202, 9309887.626445604488254],
            //                         [701553.547984099015594, 9309874.379382280632854],
            //                         [701427.272267985390499, 9309855.553727678954601],
            //                         [701386.494598877150565, 9309867.976446153596044],
            //                         [701346.20911806426011, 9309893.127301448956132],
            //                         [701301.218164272373542, 9309923.105877073481679],
            //                         [701252.680039484985173, 9309955.277555039152503],
            //                         [701193.532051821472123, 9309993.239380659535527],
            //                         [701110.34903146349825, 9310041.873452397063375],
            //                         [701057.513277828460559, 9310054.817578120157123],
            //                         [701011.215342122130096, 9310055.997247062623501],
            //                         [700962.586698345141485, 9310047.868154086172581],
            //                         [700913.261927832150832, 9310043.144445769488811],
            //                         [700851.745391797623597, 9310045.514266734942794],
            //                         [700828.59033169853501, 9310052.47438333556056],
            //                         [700815.239214610075578, 9310064.898826779797673],
            //                         [700791.413278287742287, 9310099.697530243545771],
            //                         [700770.262326849508099, 9310159.560194125398993],
            //                         [700725.354946199804544, 9310274.472835252061486],
            //                         [700707.033169939881191, 9310310.217001277953386],
            //                         [700677.522868260857649, 9310385.859700450673699],
            //                         [700636.435094065847807, 9310482.436677003279328],
            //                         [700588.813470721361227, 9310561.034840621054173],
            //                         [700504.395179685438052, 9310666.76152478158474],
            //                         [700429.53417574823834, 9310728.73768381588161],
            //                         [700384.344062883756123, 9310761.681093441322446],
            //                         [700310.728657368570566, 9310809.508885597810149],
            //                         [700224.322582970838994, 9310859.300991581752896],
            //                         [700179.635472438530996, 9310886.156059857457876],
            //                         [700110.556445343885571, 9310918.40120754390955],
            //                         [700036.115234822500497, 9310950.768694864585996],
            //                         [699976.714851782191545, 9310975.002788975834846],
            //                         [699911.697718122974038, 9310995.018346600234509],
            //                         [699865.805246734875254, 9311011.105823963880539],
            //                         [699813.49171432456933, 9311029.269484346732497],
            //                         [699750.080124776461162, 9311051.295100413262844],
            //                         [699688.804559867130592, 9311070.336575292050838],
            //                         [699614.466947801178321, 9311087.928107077255845],
            //                         [699532.295093532302417, 9311100.554998280480504],
            //                         [699451.982601111754775, 9311106.889674864709377],
            //                         [699384.391420236090198, 9311108.014877209439874],
            //                         [699324.019699721364304, 9311109.90503222681582],
            //                         [699280.067752785864286, 9311110.367571547627449],
            //                         [699250.457998634083197, 9311108.739286249503493],
            //                         [699236.776066291728057, 9311104.197248244658113],
            //                         [699222.48381626419723, 9311095.878152972087264],
            //                         [699203.191559960716404, 9311086.14784698933363],
            //                         [699193.982282281620428, 9311084.707309337332845],
            //                         [699176.953183707315475, 9311088.222685908898711],
            //                         [699159.43236706755124, 9311096.515247102826834],
            //                         [699144.547367578139529, 9311106.540290560573339],
            //                         [699127.053064856794663, 9311102.946159072220325],
            //                         [699116.395126696676016, 9311109.009748155251145],
            //                         [699094.565861322334968, 9311118.589038157835603],
            //                         [699154.489790779189207, 9311177.670933099463582],
            //                         [699339.966475181980059, 9311327.305584687739611],
            //                         [699568.984786642016843, 9311501.577302843332291],
            //                         [699828.913335844757967, 9311690.728708537295461],
            //                         [700103.311595062725246, 9311867.716503798961639],
            //                         [700322.474553251289763, 9312036.617280572652817],
            //                         [700506.341470151208341, 9312179.535959295928478],
            //                         [700608.750571355689317, 9312259.484876153990626],
            //                         [700797.144596420926973, 9312408.397908173501492],
            //                         [700945.294442514306866, 9312524.679976960644126],
            //                         [701094.426506425719708, 9312641.947663456201553],
            //                         [701200.576648605754599, 9312732.795861169695854],
            //                         [701261.684958882629871, 9312799.133095992729068],
            //                         [701324.12104933115188, 9312879.446141365915537],
            //                         [701356.93721373565495, 9312929.365614967420697],
            //                         [701420.901919111143798, 9313048.51173498108983],
            //                         [701489.989855509717017, 9313185.123324383050203],
            //                         [701537.867877315264195, 9313281.282532265409827],
            //                         [701575.104735285625793, 9313385.901925643905997],
            //                         [701591.892238840111531, 9313445.07010536454618],
            //                         [701601.50913140818011, 9313502.913754135370255],
            //                         [701607.663501319591887, 9313560.848283614963293],
            //                         [701615.782014324562624, 9313623.929199730977416],
            //                         [701625.314470487879589, 9313729.494885677471757],
            //                         [701634.714252855279483, 9313807.663466569036245],
            //                         [701648.296908944030292, 9313890.184128990396857],
            //                         [701655.689717886038125, 9313936.262691246345639],
            //                         [701666.084514896385372, 9313983.408076949417591],
            //                         [701678.916043129051104, 9314040.004307059571147],
            //                         [701682.674567916896194, 9314066.688023772090673],
            //                         [701695.020903395139612, 9314109.106365920975804],
            //                         [701703.43601257703267, 9314146.671917870640755],
            //                         [701710.923099848558195, 9314181.777282843366265],
            //                         [701719.931880898075178, 9314233.944445202127099],
            //                         [701725.26488209341187, 9314284.422012744471431],
            //                         [701728.115060484036803, 9314352.497395258396864],
            //                         [701727.897074175067246, 9314418.868674324825406],
            //                         [701724.380547160864808, 9314525.610737718641758],
            //                         [701723.985205570003018, 9314598.908696478232741],
            //                         [701722.106518014450558, 9314711.432037301361561],
            //                         [701719.809170639840886, 9314796.309948926791549],
            //                         [701721.856326743261889, 9314827.004032572731376],
            //                         [701738.905767768505029, 9314844.305263953283429],
            //                     ],
            //                 ],
            //                 type: "Polygon",
            //             },
            //         },
            //     ],
            // };

            fetch(url_to_geotiff_file)
                .then((response) => response.arrayBuffer())
                .then((arrayBuffer) => {
                    parseGeoraster(arrayBuffer).then((georaster) => {
                        const min = georaster.mins[0];
                        const max = georaster.maxs[0];
                        const range = georaster.ranges[0];

                        // available color scales can be found by running console.log(chroma.brewer);
                        console.log(chroma.brewer);
                        var scale = chroma.scale("YlOrRd");

                        var layer = new GeoRasterLayer({
                            georaster: georaster,
                            opacity: 1,
                            mask: "data/ar_kajian_gcs.geojson",
                            // mask: clipArea,
                            mask_strategy: "outside",
                            pixelValuesToColorFn: function (pixelValues) {
                                var pixelValue = pixelValues[0]; // there's just one band in this raster

                                // if there's zero wind, don't return a color
                                if (pixelValue === 0) return null;

                                // scale to 0 - 1 used by chroma
                                var scaledPixelValue = (pixelValue - min) / range;

                                var color = scale(scaledPixelValue).hex();

                                return color;
                            },
                            resolution: 256,
                        });
                        console.log("layer:", layer);
                        layer.addTo(map);

                        map.fitBounds(layer.getBounds());
                    });
                });
        </script>
    </body>
</html>
